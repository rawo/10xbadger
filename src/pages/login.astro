---
import Layout from "@/layouts/Layout.astro";
import { LoginView } from "@/components/auth/LoginView";

/**
 * Login Page
 *
 * Entry point for authentication. Displays email/password login form and handles
 * error/success messages from query parameters.
 *
 * Query Parameters:
 * - error: Error code to display (e.g., invalid_credentials, email_not_confirmed, session_expired)
 * - message: Success message to display (e.g., logged_out, email_verified, password_reset_success)
 * - redirect: URL to redirect to after successful authentication
 */

const error = Astro.url.searchParams.get("error") || undefined;
const message = Astro.url.searchParams.get("message") || undefined;
const redirectUrl = Astro.url.searchParams.get("redirect") || "/";

// Check if user is already authenticated and redirect to intended destination
const supabase = Astro.locals.supabase;
const {
  data: { user },
} = await supabase.auth.getUser();

if (user) {
  return Astro.redirect(redirectUrl);
}
---

<Layout title="Sign In - 10xbadger">
  <LoginView client:load error={error} message={message} redirectUrl={redirectUrl} />
</Layout>
